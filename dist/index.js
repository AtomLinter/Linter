"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("atom"),t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,r=i||s||Function("return this")(),n=r.Symbol,o=Object.prototype,a=o.hasOwnProperty,d=o.toString,l=n?n.toStringTag:void 0;var c=function(e){var t=a.call(e,l),i=e[l];try{e[l]=void 0;var s=!0}catch(e){}var r=d.call(e);return s&&(t?e[l]=i:delete e[l]),r},h=Object.prototype.toString;var u=function(e){return h.call(e)},g=n?n.toStringTag:void 0;var p=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":g&&g in Object(e)?c(e):u(e)};var f=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var m,v=function(e){if(!f(e))return!1;var t=p(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},b=r["__core-js_shared__"],y=(m=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"";var w=function(e){return!!y&&y in e},_=Function.prototype.toString;var I=function(e){if(null!=e){try{return _.call(e)}catch(e){}try{return e+""}catch(e){}}return""},L=/^\[object .+?Constructor\]$/,E=Function.prototype,D=Object.prototype,$=E.toString,P=D.hasOwnProperty,M=RegExp("^"+$.call(P).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var C=function(e){return!(!f(e)||w(e))&&(v(e)?M:L).test(I(e))};var j=function(e,t){return null==e?void 0:e[t]};var O=function(e,t){var i=j(e,t);return C(i)?i:void 0},A=O(Object,"create");var S=function(){this.__data__=A?A(null):{},this.size=0};var U=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},N=Object.prototype.hasOwnProperty;var T=function(e){var t=this.__data__;if(A){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return N.call(t,e)?t[e]:void 0},k=Object.prototype.hasOwnProperty;var x=function(e){var t=this.__data__;return A?void 0!==t[e]:k.call(t,e)};var R=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=A&&void 0===t?"__lodash_hash_undefined__":t,this};function F(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}F.prototype.clear=S,F.prototype.delete=U,F.prototype.get=T,F.prototype.has=x,F.prototype.set=R;var B=F;var z=function(){this.__data__=[],this.size=0};var q=function(e,t){return e===t||e!=e&&t!=t};var V=function(e,t){for(var i=e.length;i--;)if(q(e[i][0],t))return i;return-1},G=Array.prototype.splice;var K=function(e){var t=this.__data__,i=V(t,e);return!(i<0)&&(i==t.length-1?t.pop():G.call(t,i,1),--this.size,!0)};var W=function(e){var t=this.__data__,i=V(t,e);return i<0?void 0:t[i][1]};var Y=function(e){return V(this.__data__,e)>-1};var X=function(e,t){var i=this.__data__,s=V(i,e);return s<0?(++this.size,i.push([e,t])):i[s][1]=t,this};function H(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}H.prototype.clear=z,H.prototype.delete=K,H.prototype.get=W,H.prototype.has=Y,H.prototype.set=X;var J=H,Q=O(r,"Map");var Z=function(){this.size=0,this.__data__={hash:new B,map:new(Q||J),string:new B}};var ee=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var te=function(e,t){var i=e.__data__;return ee(t)?i["string"==typeof t?"string":"hash"]:i.map};var ie=function(e){var t=te(this,e).delete(e);return this.size-=t?1:0,t};var se=function(e){return te(this,e).get(e)};var re=function(e){return te(this,e).has(e)};var ne=function(e,t){var i=te(this,e),s=i.size;return i.set(e,t),this.size+=i.size==s?0:1,this};function oe(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}oe.prototype.clear=Z,oe.prototype.delete=ie,oe.prototype.get=se,oe.prototype.has=re,oe.prototype.set=ne;var ae=oe;var de=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var le=function(e){return this.__data__.has(e)};function ce(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new ae;++t<i;)this.add(e[t])}ce.prototype.add=ce.prototype.push=de,ce.prototype.has=le;var he=ce;var ue=function(e,t,i,s){for(var r=e.length,n=i+(s?1:-1);s?n--:++n<r;)if(t(e[n],n,e))return n;return-1};var ge=function(e){return e!=e};var pe=function(e,t,i){for(var s=i-1,r=e.length;++s<r;)if(e[s]===t)return s;return-1};var fe=function(e,t,i){return t==t?pe(e,t,i):ue(e,ge,i)};var me=function(e,t){return!!(null==e?0:e.length)&&fe(e,t,0)>-1};var ve=function(e,t,i){for(var s=-1,r=null==e?0:e.length;++s<r;)if(i(t,e[s]))return!0;return!1};var be=function(e,t){return e.has(t)},ye=O(r,"Set");var we=function(){};var _e=function(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i},Ie=ye&&1/_e(new ye([,-0]))[1]==1/0?function(e){return new ye(e)}:we;var Le=function(e,t,i){var s=-1,r=me,n=e.length,o=!0,a=[],d=a;if(i)o=!1,r=ve;else if(n>=200){var l=t?null:Ie(e);if(l)return _e(l);o=!1,r=be,d=new he}else d=t?[]:a;e:for(;++s<n;){var c=e[s],h=t?t(c):c;if(c=i||0!==c?c:0,o&&h==h){for(var u=d.length;u--;)if(d[u]===h)continue e;t&&d.push(h),a.push(c)}else r(d,h,i)||(d!==a&&d.push(h),a.push(c))}return a};var Ee=function(e){return e&&e.length?Le(e):[]};function De(e,t,i){const s=i.map((e=>`  â€¢ ${e}`));atom.notifications.addWarning(`[Linter] ${e}`,{dismissable:!0,detail:`${t}\n${s.join("\n")}`})}const $e=new Set(["error","warning","info"]);function Pe(t,i){const s=[];if(Array.isArray(i)){let t=!1,r=!1,n=!1,o=!1,a=!1,d=!1,l=!1,c=!1,h=!1;for(let u=0,{length:g}=i;u<g;++u){const g=i[u],{reference:p}=g;if(!r&&g.icon&&"string"!=typeof g.icon&&(r=!0,s.push("Message.icon must be a string")),o||g.location&&"object"==typeof g.location&&"string"==typeof g.location.file&&"object"==typeof g.location.position&&g.location.position){if(!o){const t=e.Range.fromObject(g.location.position);(Number.isNaN(t.start.row)||Number.isNaN(t.start.column)||Number.isNaN(t.end.row)||Number.isNaN(t.end.column))&&(o=!0,s.push("Message.location.position should not contain NaN coordinates"))}}else o=!0,s.push("Message.location must be valid");if(d||!g.solutions||Array.isArray(g.solutions)||g.solutions instanceof Promise||(d=!0,s.push("Message.solutions must be valid")),l||!p||"object"==typeof p&&"string"==typeof p.file&&"object"==typeof p.position&&p.position){if(!l&&p&&void 0!==p.position){const t=e.Point.fromObject(p.position);(Number.isNaN(t.row)||Number.isNaN(t.column))&&(l=!0,s.push("Message.reference.position should not contain NaN coordinates"))}}else l=!0,s.push("Message.reference must be valid");n||"string"==typeof g.excerpt||(n=!0,s.push("Message.excerpt must be a string")),a||$e.has(g.severity)||(a=!0,s.push("Message.severity must be 'error', 'warning' or 'info'")),!t&&g.url&&"string"!=typeof g.url&&(t=!0,s.push("Message.url must be a string")),!c&&g.description&&"function"!=typeof g.description&&"string"!=typeof g.description&&(c=!0,s.push("Message.description must be a function or string")),!h&&g.linterName&&"string"!=typeof g.linterName&&(h=!0,s.push("Message.linterName must be a string"))}}else s.push("Linter Result must be an Array");return!s.length||(De("Invalid Linter Result received",`These issues were encountered while processing messages from a linter named '${t}'`,s),!1)}class Me{constructor(){this.providers=new Set,this.subscriptions=new e.CompositeDisposable}add(e){!this.providers.has(e)&&function(e){const t=[];return e&&"object"==typeof e?("string"!=typeof e.name&&t.push("UI.name must be a string"),"function"!=typeof e.didBeginLinting&&t.push("UI.didBeginLinting must be a function"),"function"!=typeof e.didFinishLinting&&t.push("UI.didFinishLinting must be a function"),"function"!=typeof e.render&&t.push("UI.render must be a function"),"function"!=typeof e.dispose&&t.push("UI.dispose must be a function")):t.push("UI must be an object"),!t.length||(De("Invalid UI received",`These issues were encountered while registering the UI named '${e&&e.name?e.name:"Unknown"}'`,t),!1)}(e)&&(this.subscriptions.add(e),this.providers.add(e))}delete(e){this.providers.has(e)&&(e.dispose(),this.providers.delete(e))}getProviders(){return Array.from(this.providers)}render(e){this.providers.forEach((function(t){t.render(e)}))}didBeginLinting(e,t=null){this.providers.forEach((function(i){i.didBeginLinting(e,t)}))}didFinishLinting(e,t=null){this.providers.forEach((function(i){i.didFinishLinting(e,t)}))}dispose(){this.providers.clear(),this.subscriptions.dispose()}}const Ce="__$sb_linter_activated",je="__$sb_linter_request_last_received";function Oe(e,t,i){return!(t&&!e.lintsOnChange)&&i.some((function(t){return e.grammarScopes.includes(t)}))}function Ae(e){return Ee(e.getCursors().reduce(((e,t)=>e.concat(t.getScopeDescriptor().getScopesArray())),["*"]))}let Se;async function Ue(t,i,s){if(!t)return!0;if(s){const i=new e.Directory(t),s=await atom.project.repositoryForDirectory(i);if(s&&s.isPathIgnored(t))return!0}const r="win32"===process.platform?t.replace(/\\/g,"/"):t;return Se||(Se=require("minimatch")),Se(r,i)}function Ne(e){const{reference:t,location:i}=e;e.key=[`$LINTER:${e.linterName}`,`$LOCATION:${i.file}$${i.position.start.row}$${i.position.start.column}$${i.position.end.row}$${i.position.end.column}`,t?`$REFERENCE:${t.file}$${t.position?`${t.position.row}$${t.position.column}`:""}`:"$REFERENCE:null",`$EXCERPT:${e.excerpt}`,`$SEVERITY:${e.severity}`,e.icon?`$ICON:${e.icon}`:"$ICON:null",e.url?`$URL:${e.url}`:"$URL:null","string"==typeof e.description?`$DESCRIPTION:${e.description}`:"$DESCRIPTION:null"].join("")}function Te(e,t){for(let i=0,{length:s}=t;i<s;++i){const s=t[i],{reference:r,solutions:n}=s;if(s.location.position=xe(s.location.position),void 0!==r&&void 0!==r.position&&(r.position=ke(r.position)),Array.isArray(n))for(let e=0,t=n.length;e<t;e++){const t=n[e];t.position=xe(t.position)}s.version=2,s.linterName||(s.linterName=e),Ne(s)}}function ke(t){return t instanceof e.Point?t:e.Point.fromObject(t)}function xe(t){return t instanceof e.Range?t:e.Range.fromObject(t)}function Re(e,t){if(void 0===e||void 0===t)return null;if(!t.length)return{oldKept:[],oldRemoved:[],newAdded:e};if(!e.length)return{oldKept:[],oldRemoved:t,newAdded:[]};const i=function(e){const t=new Map;for(let i=0,{length:s}=e;i<s;++i){const s=e[i];t.set(s.key,s)}return t}(t),s=new Set,r=new Map;for(let t=0,n=e.length;t<n;t++){const n=e[t];i.has(n.key)?r.set(n.key,n):s.add(n)}const n=Array.from(i.keys()),o=Array.from(r.keys()),a=n.filter((e=>!o.includes(e))),d=new Set;for(let e=0,t=a.length;e<t;e++)d.add(i.get(a[e]));return{oldKept:Array.from(r.values()),oldRemoved:[...d],newAdded:[...s]}}function Fe(e,t){t.length&&Array.prototype.push.apply(e,t)}class Be{constructor(t,i){this.scope="project",this.emitter=new e.Emitter,this.messages=new Map,this.subscriptions=new e.CompositeDisposable,this.indie=t,this.version=i,this.subscriptions.add(this.emitter)}get name(){return this.indie.name}getMessages(){const e=[];return this.messages.forEach((t=>{Fe(e,t)})),e}clearMessages(){this.subscriptions.disposed||(this.emitter.emit("did-update",[]),this.messages.clear())}setMessages(e,t=null){if("string"!=typeof e||!Array.isArray(t))throw new Error("Invalid Parameters to setMessages()");!this.subscriptions.disposed&&Pe(this.name,t)&&(t.forEach((function(t){if(t.location.file!==e)throw console.debug("[Linter-UI-Default] Expected File",e,"Message",t),new Error("message.location.file does not match the given filePath")})),Te(this.name,t),this.messages.set(e,t),this.emitter.emit("did-update",this.getMessages()))}setAllMessages(e){if(!this.subscriptions.disposed&&(Array.isArray(e)&&!atom.inDevMode()||Pe(this.name,e))){Te(this.name,e),this.messages.clear();for(let t=0,{length:i}=e;t<i;++t){const i=e[t],s=i.location.file;let r=this.messages.get(s);r||this.messages.set(s,r=[]),r.push(i)}this.emitter.emit("did-update",this.getMessages())}}onDidUpdate(e){return this.emitter.on("did-update",e)}onDidDestroy(e){return this.emitter.on("did-destroy",e)}dispose(){this.emitter.emit("did-destroy"),this.subscriptions.dispose(),this.messages.clear()}}class ze{constructor(){this.emitter=new e.Emitter,this.delegates=new Set,this.subscriptions=new e.CompositeDisposable,this.subscriptions.add(this.emitter)}register(e,t){if(!function(e){const t=[];return e&&"object"==typeof e?"string"!=typeof e.name&&t.push("Indie.name must be a string"):t.push("Indie must be an object"),!t.length||(De("Invalid Indie received",`These issues were encountered while registering an Indie Linter named '${e&&e.name?e.name:"Unknown"}'`,t),!1)}(e))throw new Error("Error registering Indie Linter");const i=new Be(e,t);return this.delegates.add(i),i.onDidDestroy((()=>{this.delegates.delete(i)})),i.onDidUpdate((e=>{this.emitter.emit("did-update",{linter:i,messages:e})})),this.emitter.emit("observe",i),i}getProviders(){return Array.from(this.delegates)}observe(e){return this.delegates.forEach(e),this.emitter.on("observe",e)}onDidUpdate(e){return this.emitter.on("did-update",e)}dispose(){for(const e of this.delegates)e.dispose();this.subscriptions.dispose()}}var qe=function(){return r.Date.now()},Ve=/\s/;var Ge=function(e){for(var t=e.length;t--&&Ve.test(e.charAt(t)););return t},Ke=/^\s+/;var We=function(e){return e?e.slice(0,Ge(e)+1).replace(Ke,""):e};var Ye=function(e){return null!=e&&"object"==typeof e};var Xe=function(e){return"symbol"==typeof e||Ye(e)&&"[object Symbol]"==p(e)},He=/^[-+]0x[0-9a-f]+$/i,Je=/^0b[01]+$/i,Qe=/^0o[0-7]+$/i,Ze=parseInt;var et=function(e){if("number"==typeof e)return e;if(Xe(e))return NaN;if(f(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=f(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=We(e);var i=Je.test(e);return i||Qe.test(e)?Ze(e.slice(2),i?2:8):He.test(e)?NaN:+e},tt=Math.max,it=Math.min;var st=function(e,t,i){var s,r,n,o,a,d,l=0,c=!1,h=!1,u=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var i=s,n=r;return s=r=void 0,l=t,o=e.apply(n,i)}function p(e){return l=e,a=setTimeout(v,t),c?g(e):o}function m(e){var i=e-d;return void 0===d||i>=t||i<0||h&&e-l>=n}function v(){var e=qe();if(m(e))return b(e);a=setTimeout(v,function(e){var i=t-(e-d);return h?it(i,n-(e-l)):i}(e))}function b(e){return a=void 0,u&&s?g(e):(s=r=void 0,o)}function y(){var e=qe(),i=m(e);if(s=arguments,r=this,d=e,i){if(void 0===a)return p(d);if(h)return clearTimeout(a),a=setTimeout(v,t),g(d)}return void 0===a&&(a=setTimeout(v,t)),o}return t=et(t)||0,f(i)&&(c=!!i.leading,n=(h="maxWait"in i)?tt(et(i.maxWait)||0,t):n,u="trailing"in i?!!i.trailing:u),y.cancel=function(){void 0!==a&&clearTimeout(a),l=0,s=d=r=a=void 0},y.flush=function(){return void 0===a?o:b(qe())},y};class rt{constructor(){this.emitter=new e.Emitter,this.messages=[],this.messagesMap=new Set,this.subscriptions=new e.CompositeDisposable,this.debouncedUpdate=st(this.update,100,{leading:!0}),this.subscriptions.add(this.emitter)}set({messages:e,linter:t,buffer:i}){let s=null;for(const e of this.messagesMap)if(e.buffer===i&&e.linter===t){s=e;break}s?(s.messages=e,s.changed=!0):this.messagesMap.add({messages:e,linter:t,buffer:i,oldMessages:[],changed:!0,deleted:!1}),this.debouncedUpdate()}update(){const e={added:[],removed:[],messages:[]};for(const t of this.messagesMap){if(t.deleted){Fe(e.removed,t.oldMessages),this.messagesMap.delete(t);continue}if(!t.changed){Fe(e.messages,t.oldMessages);continue}const i=Re(t.messages,t.oldMessages);if(null!==i){const{oldKept:s,oldRemoved:r,newAdded:n}=i;Fe(e.added,n),Fe(e.removed,r);const o=n.concat(s);Fe(e.messages,o),t.oldMessages=o}}(e.added.length||e.removed.length)&&(this.messages=e.messages,this.emitter.emit("did-update-messages",e))}onDidUpdateMessages(e){return this.emitter.on("did-update-messages",e)}deleteByBuffer(e){for(const t of this.messagesMap)t.buffer===e&&(t.deleted=!0);this.debouncedUpdate()}deleteByLinter(e){for(const t of this.messagesMap)t.linter===e&&(t.deleted=!0);this.debouncedUpdate()}dispose(){this.subscriptions.dispose()}}class nt{constructor(){this.emitter=new e.Emitter,this.linters=new Set,this.lintOnChange=!0,this.ignoreVCS=!0,this.ignoreGlob="**/*.min.{js,css}",this.lintPreviewTabs=!0,this.subscriptions=new e.CompositeDisposable,this.disabledProviders=[],this.activeNotifications=new Set,this.subscriptions.add(this.emitter,atom.config.observe("linter.lintOnChange",(e=>{this.lintOnChange=e})),atom.config.observe("core.excludeVcsIgnoredPaths",(e=>{this.ignoreVCS=e})),atom.config.observe("linter.ignoreGlob",(e=>{this.ignoreGlob=e})),atom.config.observe("linter.lintPreviewTabs",(e=>{this.lintPreviewTabs=e})),atom.config.observe("linter.disabledProviders",(e=>{this.disabledProviders=e})))}hasLinter(e){return this.linters.has(e)}addLinter(e){(function(e){const t=[];return e&&"object"==typeof e?("string"!=typeof e.name&&t.push("Linter.name must be a string"),("string"!=typeof e.scope||"file"!==e.scope&&"project"!==e.scope)&&t.push("Linter.scope must be either 'file' or 'project'"),"boolean"!=typeof e.lintsOnChange&&t.push("Linter.lintsOnChange must be a boolean"),Array.isArray(e.grammarScopes)||t.push("Linter.grammarScopes must be an Array"),"function"!=typeof e.lint&&t.push("Linter.lint must be a function")):t.push("Linter must be an object"),!t.length||(De("Invalid Linter received",`These issues were encountered while registering a Linter named '${e&&e.name?e.name:"Unknown"}'`,t),!1)})(e)&&(e[Ce]=!0,void 0===e.__$sb_linter_request_latest&&(e.__$sb_linter_request_latest=0),void 0===e[je]&&(e[je]=0),e.__$sb_linter_version=2,this.linters.add(e))}getProviders(){return Array.from(this.linters)}deleteLinter(e){this.linters.has(e)&&(e[Ce]=!1,this.linters.delete(e))}async lint({onChange:e,editor:t}){const i=t.getPath();if(e&&!this.lintOnChange||!this.lintPreviewTabs&&atom.workspace.getActivePane().getPendingItem()===t||await Ue(t.getPath(),this.ignoreGlob,this.ignoreVCS))return!1;const s=Ae(t),r=[];for(const n of this.linters){if(!Oe(n,e,s))continue;if(this.disabledProviders.includes(n.name))continue;const o=++n.__$sb_linter_request_latest,a="file"===n.scope?t.getBuffer():null,d="file"===n.scope?i:null;this.emitter.emit("did-begin-linting",{number:o,linter:n,filePath:d}),r.push(new Promise((function(e){e(n.lint(t))})).then((e=>{if(this.emitter.emit("did-finish-linting",{number:o,linter:n,filePath:d}),n[je]>=o||!n[Ce]||a&&!a.isAlive())return;if(n[je]=o,a&&!a.isAlive())return;if(null===e)return;let t=!0;!atom.inDevMode()&&Array.isArray(e)||(t=Pe(n.name,e)),t&&(Te(n.name,e),this.emitter.emit("did-update-messages",{messages:e,linter:n,buffer:a}))}),(e=>{this.emitter.emit("did-finish-linting",{number:o,linter:n,filePath:d}),console.error(`[Linter] Error running ${n.name}`,e);const t=`[Linter] Error running ${n.name}`;if(Array.from(this.activeNotifications).some((e=>e.getOptions().detail===t)))return;const i=atom.notifications.addError(t,{detail:"See Console for more info.",dismissable:!0,buttons:[{text:"Open Console",onDidClick:()=>{atom.openDevTools(),i.dismiss()}},{text:"Cancel",onDidClick:()=>{i.dismiss()}}]})})))}return await Promise.all(r),!0}onDidUpdateMessages(e){return this.emitter.on("did-update-messages",e)}onDidBeginLinting(e){return this.emitter.on("did-begin-linting",e)}onDidFinishLinting(e){return this.emitter.on("did-finish-linting",e)}dispose(){this.activeNotifications.forEach((e=>e.dismiss())),this.activeNotifications.clear(),this.linters.clear(),this.subscriptions.dispose()}}class ot{constructor(t){if(this.emitter=new e.Emitter,this.subscriptions=new e.CompositeDisposable,!atom.workspace.isTextEditor(t))throw new Error("EditorLinter expects a valid TextEditor");const i=t.getBuffer(),s=st((()=>{this.emitter.emit("should-lint",!1)}),50,{leading:!0});this.editor=t,this.subscriptions.add(this.editor.onDidDestroy((()=>this.dispose())),this.editor.onDidSave(s),i.onDidReload(s),this.subscriptiveObserve(atom.config,"linter.lintOnChangeInterval",(e=>i.onDidChange(st((()=>{this.emitter.emit("should-lint",!0)}),e)))))}getEditor(){return this.editor}lint(e=!1){this.emitter.emit("should-lint",e)}onShouldLint(e){return this.emitter.on("should-lint",e)}onDidDestroy(e){return this.emitter.on("did-destroy",e)}dispose(){this.emitter.emit("did-destroy"),this.subscriptions.dispose(),this.emitter.dispose()}subscriptiveObserve(t,i,s){let r=null;const n=t.observe(i,(e=>{r&&r.dispose(),r=s.call(this,e)}));return new e.Disposable((function(){n.dispose(),r&&r.dispose()}))}}class at{constructor(){this.emitter=new e.Emitter,this.lintOnOpen=!0,this.subscriptions=new e.CompositeDisposable,this.editorLinters=new Map,this.subscriptions.add(this.emitter,atom.config.observe("linter.lintOnOpen",(e=>{this.lintOnOpen=e})))}activate(){this.subscriptions.add(atom.workspace.observeTextEditors((e=>{this.createFromTextEditor(e)})))}get(e){return this.editorLinters.get(e)}createFromTextEditor(e){let t=this.editorLinters.get(e);return t||(t=new ot(e),t.onDidDestroy((()=>{this.editorLinters.delete(e)})),this.editorLinters.set(e,t),this.emitter.emit("observe",t),this.lintOnOpen&&t.lint(),t)}hasSibling(e){const t=e.getEditor().getBuffer();return Array.from(this.editorLinters.keys()).some((e=>e.getBuffer()===t))}observe(e){return this.editorLinters.forEach(e),this.emitter.on("observe",e)}dispose(){for(const e of this.editorLinters.values())e.dispose();this.subscriptions.dispose()}}let dt,lt,ct,ht;function ut(e){let t;if(e&&"object"==typeof e&&"string"==typeof e.name)t=e.name;else{if("string"!=typeof e)throw new Error("Unknown object passed to formatItem()");t=e}return`  - ${t}`}function gt(e,t){return e.name.localeCompare(t.name)}class pt{constructor(){this.emitter=new e.Emitter,this.subscriptions=new e.CompositeDisposable,this.subscriptions.add(this.emitter,atom.commands.add("atom-workspace",{"linter:enable-linter":()=>this.enableLinter(),"linter:disable-linter":()=>this.disableLinter()}),atom.commands.add("atom-text-editor:not([mini])",{"linter:lint":()=>this.lint(),"linter:debug":()=>this.debug(),"linter:toggle-active-editor":()=>this.toggleActiveEditor()}))}lint(){this.emitter.emit("should-lint")}debug(){this.emitter.emit("should-debug")}enableLinter(){this.emitter.emit("should-toggle-linter","enable")}disableLinter(){this.emitter.emit("should-toggle-linter","disable")}toggleActiveEditor(){this.emitter.emit("should-toggle-active-editor")}onShouldLint(e){return this.emitter.on("should-lint",e)}onShouldDebug(e){return this.emitter.on("should-debug",e)}onShouldToggleActiveEditor(e){return this.emitter.on("should-toggle-active-editor",e)}onShouldToggleLinter(e){return this.emitter.on("should-toggle-linter",e)}dispose(){this.subscriptions.dispose()}}class ft{constructor(t,i){this.emitter=new e.Emitter,this.subscriptions=new e.CompositeDisposable,this.disabledProviders=[],this.action=t,this.providers=i,this.subscriptions.add(this.emitter,atom.config.observe("linter.disabledProviders",(e=>{this.disabledProviders=e})))}getItems(){return"disable"===this.action?this.providers.filter((e=>!this.disabledProviders.includes(e))):this.disabledProviders}process(e){if("disable"===this.action)this.disabledProviders.push(e),this.emitter.emit("did-disable",e);else{const t=this.disabledProviders.indexOf(e);-1!==t&&this.disabledProviders.splice(t,1)}atom.config.set("linter.disabledProviders",this.disabledProviders)}show(){lt||(lt=require("atom-select-list"));const t=new lt({items:this.getItems(),emptyMessage:"No matches found",elementForItem:e=>{const t=document.createElement("li");return t.textContent=e,t},didConfirmSelection:e=>{try{this.process(e),this.dispose()}catch(e){console.error("[Linter] Unable to process toggle:",e)}},didCancelSelection:()=>{this.dispose()},didConfirmEmptySelection:()=>{this.dispose()}}),i=atom.workspace.addModalPanel({item:t});t.focus(),this.subscriptions.add(new e.Disposable((function(){i.destroy()})))}onDidDispose(e){return this.emitter.on("did-dispose",e)}onDidDisable(e){return this.emitter.on("did-disable",e)}dispose(){this.emitter.emit("did-dispose"),this.subscriptions.dispose()}}class mt{constructor(){this.commands=new pt,this.subscriptions=new e.CompositeDisposable,this.idleCallbacks=new Set,this.subscriptions.add(this.commands),this.commands.onShouldLint((()=>{this.registryEditorsInit();const e=atom.workspace.getActiveTextEditor();if(void 0===e)return;const t=this.registryEditors.get(e);t&&t.lint()})),this.commands.onShouldToggleActiveEditor((()=>{const e=atom.workspace.getActiveTextEditor();if(void 0===e)return;this.registryEditorsInit();const t=this.registryEditors.get(e);t?t.dispose():e&&this.registryEditors.createFromTextEditor(e)})),this.commands.onShouldDebug((async()=>{this.registryUIInit(),this.registryIndieInit(),this.registryLintersInit(),await async function(e,t,i){dt||(dt=require("../package.json"));const s=atom.workspace.getActiveTextEditor();if(void 0===s)return;const r=Ae(s),n=e.slice().sort(gt),o=t.slice().sort(gt),a=i.slice().sort(gt),d=o.map(ut).join("\n"),l=n.map(ut).join("\n"),c=n.filter((e=>Oe(e,!1,r))).map(ut).join("\n"),h=r.map(ut).join("\n"),u=a.map(ut).join("\n"),g=atom.config.get("linter.ignoreGlob"),p=atom.config.get("core.excludeVcsIgnoredPaths"),f=atom.config.get("linter.disabledProviders").map(ut).join("\n"),m=await Ue(s.getPath(),g,p);atom.notifications.addInfo("Linter Debug Info",{detail:[`Platform: ${process.platform}`,`Atom Version: ${atom.getVersion()}`,`Linter Version: ${dt.version}`,"Opened file is ignored: "+(m?"Yes":"No"),`Matching Linter Providers: \n${c}`,`Disabled Linter Providers: \n${f}`,`Standard Linter Providers: \n${l}`,`Indie Linter Providers: \n${d}`,`UI Providers: \n${u}`,`Ignore Glob: ${g}`,`VCS Ignored Paths are excluded: ${p}`,`Current File Scopes: \n${h}`].join("\n"),dismissable:!0})}(this.registryLinters.getProviders(),this.registryIndie.getProviders(),this.registryUI.getProviders())})),this.commands.onShouldToggleLinter((e=>{this.registryLintersInit();const t=new ft(e,Ee(this.registryLinters.getProviders().map((e=>e.name))));t.onDidDispose((()=>{this.subscriptions.remove(t)})),t.onDidDisable((e=>{const t=this.registryLinters.getProviders().find((t=>t.name===e));t&&(this.registryMessagesInit(),this.registryMessages.deleteByLinter(t))})),t.show(),this.subscriptions.add(t)}));const t=window.requestIdleCallback((()=>{this.idleCallbacks.delete(t),this.subscriptions.add(atom.project.onDidChangePaths((()=>{this.commands.lint()})))}));this.idleCallbacks.add(t);const i=window.requestIdleCallback((()=>{this.idleCallbacks.delete(i),this.registryEditorsInit()}));this.idleCallbacks.add(i)}dispose(){this.idleCallbacks.forEach((e=>window.cancelIdleCallback(e))),this.idleCallbacks.clear(),this.subscriptions.dispose()}registryEditorsInit(){void 0===this.registryEditors&&(this.registryEditors=new at,this.subscriptions.add(this.registryEditors),this.registryEditors.observe((e=>{e.onShouldLint((t=>{this.registryLintersInit(),this.registryLinters.lint({onChange:t,editor:e.getEditor()})})),e.onDidDestroy((()=>{this.registryMessagesInit(),this.registryEditors.hasSibling(e)||this.registryMessages.deleteByBuffer(e.getEditor().getBuffer())}))})),this.registryEditors.activate())}registryLintersInit(){void 0===this.registryLinters&&(this.registryLinters=new nt,this.subscriptions.add(this.registryLinters),this.registryLinters.onDidUpdateMessages((({linter:e,messages:t,buffer:i})=>{this.registryMessagesInit(),this.registryMessages.set({linter:e,messages:t,buffer:i})})),this.registryLinters.onDidBeginLinting((({linter:e,filePath:t})=>{this.registryUIInit(),this.registryUI.didBeginLinting(e,t)})),this.registryLinters.onDidFinishLinting((({linter:e,filePath:t})=>{this.registryUIInit(),this.registryUI.didFinishLinting(e,t)})))}registryIndieInit(){void 0===this.registryIndie&&(this.registryIndie=new ze,this.subscriptions.add(this.registryIndie),this.registryIndie.observe((e=>{e.onDidDestroy((()=>{this.registryMessagesInit(),this.registryMessages.deleteByLinter(e)}))})),this.registryIndie.onDidUpdate((({linter:e,messages:t})=>{this.registryMessagesInit(),this.registryMessages.set({linter:e,messages:t,buffer:null})})))}registryMessagesInit(){this.registryMessages||(this.registryMessages=new rt,this.subscriptions.add(this.registryMessages),this.registryMessages.onDidUpdateMessages((e=>{this.registryUIInit(),this.registryUI.render(e)})))}registryUIInit(){void 0===this.registryUI&&(this.registryUI=new Me,this.subscriptions.add(this.registryUI))}addUI(e){this.registryUIInit(),this.registryUI.add(e),this.registryMessagesInit();const t=this.registryMessages.messages;t.length&&e.render({added:t,messages:t,removed:[]})}deleteUI(e){this.registryUIInit(),this.registryUI.delete(e)}addLinter(e){this.registryLintersInit(),this.registryLinters.addLinter(e)}deleteLinter(e){this.registryLintersInit(),this.registryLinters.deleteLinter(e),this.registryMessagesInit(),this.registryMessages.deleteByLinter(e)}addIndie(e){return this.registryIndieInit(),this.registryIndie.register(e,2)}}exports.activate=function(){ht=new e.CompositeDisposable,ct=new mt,ht.add(ct,atom.packages.onDidActivateInitialPackages((function(){atom.inSpecMode()||require("atom-package-deps").install("linter",!0)})))},exports.consumeLinter=function(t){const i=Array.isArray(t)?t:[t];for(const e of i)ct.addLinter(e);return new e.Disposable((()=>{for(const e of i)ct.deleteLinter(e)}))},exports.consumeUI=function(t){const i=Array.isArray(t)?t:[t];for(const e of i)ct.addUI(e);return new e.Disposable((()=>{for(const e of i)ct.deleteUI(e)}))},exports.deactivate=function(){ht.dispose()},exports.provideIndie=function(){return e=>ct.addIndie(e)};
//# sourceMappingURL=index.js.map
